<!DOCTYPE HTML>
<html lang="zh_CN" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>4. ISR，OSR，AR，LW，HW，LEO，ACK原理理论 - 技术架构学习</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><li class="part-title">技术学习笔记</li><li class="chapter-item "><a href="../../index.html"><strong aria-hidden="true">1.</strong> 介绍</a></li><li class="chapter-item "><a href="../../chapter_0/toc.html"><strong aria-hidden="true">2.</strong> Coding</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_0/admin.html"><strong aria-hidden="true">2.1.</strong> admin</a></li><li class="chapter-item "><a href="../../chapter_0/common-design.html"><strong aria-hidden="true">2.2.</strong> common-design</a></li><li class="chapter-item "><a href="../../chapter_0/common-elasticsearch.html"><strong aria-hidden="true">2.3.</strong> common-elasticsearch</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_6/toc.html"><strong aria-hidden="true">3.</strong> Kafka</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_6/notes/Kafka_Day1.html"><strong aria-hidden="true">3.1.</strong> kafka前瞻—架构维度</a></li><li class="chapter-item "><a href="../../chapter_6/notes/Kafka_Day2.html"><strong aria-hidden="true">3.2.</strong> kafka安装以及常用的命令</a></li><li class="chapter-item "><a href="../../chapter_6/notes/Kafka_Day3.html"><strong aria-hidden="true">3.3.</strong> 基础开发及消费者提交维护offset不同粒度</a></li><li class="chapter-item expanded "><a href="../../chapter_6/notes/Kafka_Day4.html" class="active"><strong aria-hidden="true">3.4.</strong> ISR，OSR，AR，LW，HW，LEO，ACK原理理论</a></li><li class="chapter-item "><a href="../../chapter_6/Book.html"><strong aria-hidden="true">3.5.</strong> Book</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_6/mybook/Kafka-The-Definitive-Guide.html"><strong aria-hidden="true">3.5.1.</strong> Kafka权威指南</a></li><li class="chapter-item "><a href="../../chapter_6/mybook/Kafka-The-Definitive-Guide-Overview.html"><strong aria-hidden="true">3.5.2.</strong> ChatGPT写的一篇《Kafka权威指南》总结</a></li><li class="chapter-item "><a href="../../chapter_6/mybook/Apache-Kafka-In-Action.html"><strong aria-hidden="true">3.5.3.</strong> Apache Kafka实战</a></li><li class="chapter-item "><a href="../../chapter_6/mybook/Deep-Kafka.html"><strong aria-hidden="true">3.5.4.</strong> 深入理解Kafka</a></li><li class="chapter-item "><a href="../../chapter_6/mybook/Apache-Kafka-Code.html"><strong aria-hidden="true">3.5.5.</strong> Apache Kafka源码剖析</a></li><li class="chapter-item "><a href="../../chapter_6/Kafka.html"><strong aria-hidden="true">3.5.6.</strong> Kafka</a></li><li class="chapter-item "><a href="../../chapter_6/Operations.html"><strong aria-hidden="true">3.5.7.</strong> Operations</a></li><li class="chapter-item "><a href="../../chapter_6/Streaming.html"><strong aria-hidden="true">3.5.8.</strong> Streaming</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../chapter_1/toc.html"><strong aria-hidden="true">4.</strong> Akka</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_1/academy.html"><strong aria-hidden="true">4.1.</strong> Lightbend</a></li><li class="chapter-item "><a href="../../chapter_1/akka.html"><strong aria-hidden="true">4.2.</strong> Akka简介</a></li><li class="chapter-item "><a href="../../chapter_1/akka-actor.html"><strong aria-hidden="true">4.3.</strong> Akka Actor</a></li><li class="chapter-item "><a href="../../chapter_1/akka-remoting.html"><strong aria-hidden="true">4.4.</strong> Akka Remoting</a></li><li class="chapter-item "><a href="../../chapter_1/akka-http.html"><strong aria-hidden="true">4.5.</strong> Akka Http</a></li><li class="chapter-item "><a href="../../chapter_1/akka-testkit.html"><strong aria-hidden="true">4.6.</strong> Akka TestKit</a></li><li class="chapter-item "><a href="../../chapter_1/akka-stream.html"><strong aria-hidden="true">4.7.</strong> Akka Stream</a></li><li class="chapter-item "><a href="../../chapter_1/akka-distributed-data.html"><strong aria-hidden="true">4.8.</strong> Akka Distributed Data</a></li><li class="chapter-item "><a href="../../chapter_1/akka-cluster.html"><strong aria-hidden="true">4.9.</strong> Akka Cluster</a></li><li class="chapter-item "><a href="../../chapter_1/akka-persistence.html"><strong aria-hidden="true">4.10.</strong> Akka Persistence</a></li><li class="chapter-item "><a href="../../chapter_1/akka-utilities.html"><strong aria-hidden="true">4.11.</strong> Akka Utilities</a></li><li class="chapter-item "><a href="../../chapter_1/Book.html"><strong aria-hidden="true">4.12.</strong> Book</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_1/mybook/akka-in-action.html"><strong aria-hidden="true">4.12.1.</strong> Akka实战</a></li><li class="chapter-item "><a href="../../chapter_1/mybook/learning-akka.html"><strong aria-hidden="true">4.12.2.</strong> Akka入门与实践</a></li><li class="chapter-item "><a href="../../chapter_1/mybook/applied-akka-patterns.html"><strong aria-hidden="true">4.12.3.</strong> Akka应用模式</a></li><li class="chapter-item "><a href="../../chapter_1/mybook/reactive-design-pattern.html"><strong aria-hidden="true">4.12.4.</strong> 反应式设计模式</a></li><li class="chapter-item "><a href="../../chapter_1/mybook/reactive-application-development.html"><strong aria-hidden="true">4.12.5.</strong> 反应式应用开发</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../chapter_2/toc.html"><strong aria-hidden="true">5.</strong> Consul</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_2/consul.html"><strong aria-hidden="true">5.1.</strong> Consul简介</a></li></ol></li><li class="chapter-item "><a href="../../chapter_3/toc.html"><strong aria-hidden="true">6.</strong> Hazelcast</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_3/Hazelcast.html"><strong aria-hidden="true">6.1.</strong> Hazelcast简介</a></li><li class="chapter-item "><a href="../../chapter_3/cluster.html"><strong aria-hidden="true">6.2.</strong> Cluster</a></li><li class="chapter-item "><a href="../../chapter_3/Distributed-Data-Structures.html"><strong aria-hidden="true">6.3.</strong> Distributed Data Structures</a></li></ol></li><li class="chapter-item "><a href="../../chapter_4/toc.html"><strong aria-hidden="true">7.</strong> Jackson</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_4/Jackson.html"><strong aria-hidden="true">7.1.</strong> Jackson简介</a></li></ol></li><li class="chapter-item "><a href="../../chapter_5/toc.html"><strong aria-hidden="true">8.</strong> ElasticStack</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_5/elasticsearch.html"><strong aria-hidden="true">8.1.</strong> ElasticSearch</a></li><li class="chapter-item "><a href="../../chapter_5/LogStash.html"><strong aria-hidden="true">8.2.</strong> LogStash</a></li><li class="chapter-item "><a href="../../chapter_5/kibana.html"><strong aria-hidden="true">8.3.</strong> kibana</a></li><li class="chapter-item "><a href="../../chapter_5/beat.html"><strong aria-hidden="true">8.4.</strong> beat</a></li><li class="chapter-item "><a href="../../chapter_5/Lucene.html"><strong aria-hidden="true">8.5.</strong> Lucene</a></li><li class="chapter-item "><a href="../../chapter_5/Book.html"><strong aria-hidden="true">8.6.</strong> Book</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_5/mybook/elasticsearch-the-definitive-guide.html"><strong aria-hidden="true">8.6.1.</strong> Elasticsearch权威指南</a></li><li class="chapter-item "><a href="../../chapter_5/mybook/elasticsearch-in-action.html"><strong aria-hidden="true">8.6.2.</strong> Elasticsearch实战</a></li><li class="chapter-item "><a href="../../chapter_5/mybook/mastering-elasticsearch.html"><strong aria-hidden="true">8.6.3.</strong> 深入理解Elasticsearch</a></li><li class="chapter-item "><a href="../../chapter_5/mybook/elasticsearch-code.html"><strong aria-hidden="true">8.6.4.</strong> Elasticsearch源码解析与优化实战</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../chapter_7/toc.html"><strong aria-hidden="true">9.</strong> Gradle</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_7/gradle.html"><strong aria-hidden="true">9.1.</strong> Gradle简介</a></li><li class="chapter-item "><a href="../../chapter_7/Book.html"><strong aria-hidden="true">9.2.</strong> Book</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_7/mybook/gradle-in-action.html"><strong aria-hidden="true">9.2.1.</strong> Gradle实战</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../chapter_8/toc.html"><strong aria-hidden="true">10.</strong> Druid</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_8/Druid.html"><strong aria-hidden="true">10.1.</strong> Druid简介</a></li></ol></li><li class="chapter-item "><a href="../../chapter_9/toc.html"><strong aria-hidden="true">11.</strong> Spring</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_9/SpringCore.html"><strong aria-hidden="true">11.1.</strong> Spring Core</a></li><li class="chapter-item "><a href="../../chapter_9/SpringWebMVC.html"><strong aria-hidden="true">11.2.</strong> Spring WebMVC</a></li><li class="chapter-item "><a href="../../chapter_9/SpringTest.html"><strong aria-hidden="true">11.3.</strong> Spring Test</a></li><li class="chapter-item "><a href="../../chapter_9/SpringBoot.html"><strong aria-hidden="true">11.4.</strong> Spring Boot</a></li><li class="chapter-item "><a href="../../chapter_9/SpringBootAdmin.html"><strong aria-hidden="true">11.5.</strong> Spring Boot Admin</a></li><li class="chapter-item "><a href="../../chapter_9/SpringCloudCommon.html"><strong aria-hidden="true">11.6.</strong> Spring Cloud Common</a></li><li class="chapter-item "><a href="../../chapter_9/SpringCloudConsul.html"><strong aria-hidden="true">11.7.</strong> Spring Cloud Consul</a></li><li class="chapter-item "><a href="../../chapter_9/SpringCloudConfig.html"><strong aria-hidden="true">11.8.</strong> Spring Cloud Config</a></li><li class="chapter-item "><a href="../../chapter_9/SpringCloudGateway.html"><strong aria-hidden="true">11.9.</strong> Spring Cloud Gateway</a></li><li class="chapter-item "><a href="../../chapter_9/SpringCloudOpenFeign.html"><strong aria-hidden="true">11.10.</strong> Spring Cloud OpenFeign</a></li><li class="chapter-item "><a href="../../chapter_9/SpringIntegration.html"><strong aria-hidden="true">11.11.</strong> Spring Integration</a></li><li class="chapter-item "><a href="../../chapter_9/SpringOthers.html"><strong aria-hidden="true">11.12.</strong> Spring Others</a></li><li class="chapter-item "><a href="../../chapter_9/Book.html"><strong aria-hidden="true">11.13.</strong> Book</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_9/mybook/spring-in-action-4th.html"><strong aria-hidden="true">11.13.1.</strong> Spring实战第四版</a></li><li class="chapter-item "><a href="../../chapter_9/mybook/springboot-internals.html"><strong aria-hidden="true">11.13.2.</strong> SpringBoot解密</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../chapter_10/toc.html"><strong aria-hidden="true">12.</strong> KVStore</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_10/Redis.html"><strong aria-hidden="true">12.1.</strong> Redis</a></li><li class="chapter-item "><a href="../../chapter_10/MapDB.html"><strong aria-hidden="true">12.2.</strong> MapDB</a></li></ol></li><li class="chapter-item "><a href="../../chapter_11/toc.html"><strong aria-hidden="true">13.</strong> 分布式事务</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_11/atomikos.html"><strong aria-hidden="true">13.1.</strong> atomikos</a></li><li class="chapter-item "><a href="../../chapter_11/seata.html"><strong aria-hidden="true">13.2.</strong> seata</a></li><li class="chapter-item "><a href="../../chapter_11/Book.html"><strong aria-hidden="true">13.3.</strong> Book</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_11/mybook/deeping-in-dtx.html"><strong aria-hidden="true">13.3.1.</strong> 深入理解分布式事务</a></li><li class="chapter-item "><a href="../../chapter_11/mybook/seata-in-action.html"><strong aria-hidden="true">13.3.2.</strong> 正本清源分布式事务之Seata</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../chapter_12/toc.html"><strong aria-hidden="true">14.</strong> Library</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_12/httpcomponents.html"><strong aria-hidden="true">14.1.</strong> Apache-httpcomponents</a></li><li class="chapter-item "><a href="../../chapter_12/Logback.html"><strong aria-hidden="true">14.2.</strong> Logback</a></li><li class="chapter-item "><a href="../../chapter_12/poi.html"><strong aria-hidden="true">14.3.</strong> Apache-poi</a></li><li class="chapter-item "><a href="../../chapter_12/sse.html"><strong aria-hidden="true">14.4.</strong> Server-Sent-Events</a></li><li class="chapter-item "><a href="../../chapter_12/dom4j.html"><strong aria-hidden="true">14.5.</strong> dom4j</a></li><li class="chapter-item "><a href="../../chapter_12/lombok.html"><strong aria-hidden="true">14.6.</strong> lombok</a></li><li class="chapter-item "><a href="../../chapter_12/logstash-logback-encoder.html"><strong aria-hidden="true">14.7.</strong> logstash-logback-encoder</a></li><li class="chapter-item "><a href="../../chapter_12/jmx.html"><strong aria-hidden="true">14.8.</strong> jmx</a></li><li class="chapter-item "><a href="../../chapter_12/unit-test.html"><strong aria-hidden="true">14.9.</strong> 单元测试</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_12/unit-test/junit5.html"><strong aria-hidden="true">14.9.1.</strong> junit5</a></li><li class="chapter-item "><a href="../../chapter_12/unit-test/assertj.html"><strong aria-hidden="true">14.9.2.</strong> assertj</a></li><li class="chapter-item "><a href="../../chapter_12/unit-test/mockito.html"><strong aria-hidden="true">14.9.3.</strong> mockito</a></li><li class="chapter-item "><a href="../../chapter_12/unit-test/jacoco.html"><strong aria-hidden="true">14.9.4.</strong> jacoco</a></li></ol></li><li class="chapter-item "><a href="../../chapter_12/Book.html"><strong aria-hidden="true">14.10.</strong> Book</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_12/mybook/effective-unit-testing.html"><strong aria-hidden="true">14.10.1.</strong> 有效的单元测试</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../chapter_13/toc.html"><strong aria-hidden="true">15.</strong> Database</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_13/mysql.html"><strong aria-hidden="true">15.1.</strong> MySQL</a></li><li class="chapter-item "><a href="../../chapter_13/redis.html"><strong aria-hidden="true">15.2.</strong> Redis</a></li><li class="chapter-item "><a href="../../chapter_13/mongdb.html"><strong aria-hidden="true">15.3.</strong> Mongdb</a></li><li class="chapter-item "><a href="../../chapter_13/canal.html"><strong aria-hidden="true">15.4.</strong> Canal</a></li><li class="chapter-item "><a href="../../chapter_13/Doris.html"><strong aria-hidden="true">15.5.</strong> Doris</a></li></ol></li><li class="chapter-item "><a href="../../chapter_14/toc.html"><strong aria-hidden="true">16.</strong> 运维</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_14/Tracing.html"><strong aria-hidden="true">16.1.</strong> Tracing</a></li><li class="chapter-item "><a href="../../chapter_14/Monitoring.html"><strong aria-hidden="true">16.2.</strong> Monitoring</a></li><li class="chapter-item "><a href="../../chapter_14/Logging.html"><strong aria-hidden="true">16.3.</strong> Logging</a></li><li class="chapter-item "><a href="../../chapter_14/rancher.html"><strong aria-hidden="true">16.4.</strong> rancher</a></li><li class="chapter-item "><a href="../../chapter_14/kubernetes.html"><strong aria-hidden="true">16.5.</strong> kubernetes</a></li><li class="chapter-item "><a href="../../chapter_14/harbor.html"><strong aria-hidden="true">16.6.</strong> harbor</a></li></ol></li><li class="chapter-item "><a href="../../chapter_15/toc.html"><strong aria-hidden="true">17.</strong> Research</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../chapter_15/aws.html"><strong aria-hidden="true">17.1.</strong> aws</a></li><li class="chapter-item "><a href="../../chapter_15/aliyun.html"><strong aria-hidden="true">17.2.</strong> aliyun</a></li><li class="chapter-item "><a href="../../chapter_15/Replication.html"><strong aria-hidden="true">17.3.</strong> Replication</a></li><li class="chapter-item "><a href="../../chapter_15/Partitioning.html"><strong aria-hidden="true">17.4.</strong> Partitioning</a></li><li class="chapter-item "><a href="../../chapter_15/StorageEngine.html"><strong aria-hidden="true">17.5.</strong> StorageEngine</a></li><li class="chapter-item "><a href="../../chapter_15/Network-partition.html"><strong aria-hidden="true">17.6.</strong> Network Partition</a></li><li class="chapter-item "><a href="../../chapter_15/Transaction.html"><strong aria-hidden="true">17.7.</strong> Transaction</a></li><li class="chapter-item "><a href="../../chapter_15/Index.html"><strong aria-hidden="true">17.8.</strong> Index</a></li><li class="chapter-item "><a href="../../chapter_15/ResiliencyPatterns.html"><strong aria-hidden="true">17.9.</strong> ResiliencyPatterns</a></li><li class="chapter-item "><a href="../../chapter_15/ServiceRegistry.html"><strong aria-hidden="true">17.10.</strong> ServiceRegistry</a></li><li class="chapter-item "><a href="../../chapter_15/Person.html"><strong aria-hidden="true">17.11.</strong> Person</a></li></ol></li><li class="chapter-item "><a href="../../tech-sharing/toc.html"><strong aria-hidden="true">18.</strong> 技术分享</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tech-sharing/Kafka-Architect.html"><strong aria-hidden="true">18.1.</strong> Kafka-Architect</a></li></ol></li><li class="chapter-item "><a href="../../reference/reference.html"><strong aria-hidden="true">19.</strong> 参考资料</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../reference/reference.html"><strong aria-hidden="true">19.1.</strong> 参考资料</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">技术架构学习</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/alongsoCJR/tech-learning" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="kafka学习笔记"><a class="header" href="#kafka学习笔记">Kafka学习笔记</a></h1>
<h2 id="4-isrosrarlwhwleoack原理理论"><a class="header" href="#4-isrosrarlwhwleoack原理理论">4. ISR，OSR，AR，LW，HW，LEO，ACK原理理论</a></h2>
<h3 id="kafkaio"><a class="header" href="#kafkaio">kafkaIO</a></h3>
<p>零拷贝—找周老师的IO课</p>
<p>sendfile(in, offset，out)</p>
<p>kafka对数据只是发送，没有加工的过程</p>
<h3 id="分区的可靠性cap"><a class="header" href="#分区的可靠性cap">分区的可靠性（CAP）</a></h3>
<p>要解决一个问题，可能会引入其他问题，比如一致性问题</p>
<h3 id="一致性"><a class="header" href="#一致性">一致性</a></h3>
<ol>
<li>强一致性
<ol>
<li>所有节点比必须ack</li>
</ol>
</li>
<li>最终一致性
<ol>
<li>过半机制</li>
</ol>
</li>
<li>弱一致性
<ol>
<li>ISR（in-sync replicas同步副本），连通性&amp;活跃性</li>
<li>OSR（outof-sync replicas不同步副本），超过阈值时间（10s）,没有心跳</li>
<li>AR(Assignes replicas)，面向分区的副本集合，创建topic的时候你给出了分区的副本数</li>
<li>AR=ISR+OSR</li>
</ol>
</li>
<li>ack=-1的时候，多个broker的消息进度是一致的
<ol>
<li>会与ISR相关的节点进行ack</li>
</ol>
</li>
<li>tradeoff
<ol>
<li>不要强调磁盘的可靠性，转向异地多机的同步</li>
<li>如果拿磁盘做持久化，优先pagecache或者绝对磁盘</li>
<li>在多机集群分布式的时候，强一致性，最终一致性（过半，ISR）</li>
<li>总结：
<ol>
<li>redis，宁可用HA，不用刻意追求AOF的准确性</li>
<li>像Kafka，我们追求ack=-1,要求磁盘的可靠性</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="kafka弹性存储"><a class="header" href="#kafka弹性存储">kafka弹性存储</a></h3>
<p><img src="image/日志复制offset的概念.png" alt="日志复制offset的概念" /></p>
<p>首先这里有两个Broker，也就是两台服务器，然后它们的分区中分别存储了两个 p0 的副本，一个是 Leader，一个是 Follower, 此时生产者开始往 Leader Partition 发送数据，数据最终写到磁盘上的。然后 Follower 会从 Leader那里去同步数据，Follower上的数据也会写到磁盘上。<strong>可是 Follower 是先从 Leader 那去同步然后再写入磁盘的，所以它磁盘上面的数据肯定会比 Leader 的那块少一些</strong>。</p>
<h4 id="概念"><a class="header" href="#概念">概念</a></h4>
<ol>
<li>LW：Low Watermark 数据裁剪</li>
<li>HW：High Watermark，高水位：副本最新一条已提交消息的offset</li>
<li>LEO：LogEndOffset，日志末端位移：副本中下一条待写入消息的offset</li>
</ol>
<p>在 Kafka 中高水位的作用主要有2个:</p>
<ul>
<li>用来标识分区下的哪些消息是可以被消费者消费的。</li>
<li>协助 Kafka 完成副本数据同步</li>
</ul>
<p>而LEO一个重要作用就是用来更新HW:</p>
<ul>
<li>如果 Follower 和 Leader 的 LEO 数据同步了, 那么 HW 就可以更新了。</li>
<li>HW 之前的消息数据对消费者是可见的, 属于 commited 状态, HW 之后的消息数据对消费者是不可见的。</li>
</ul>
<p><img src="image/offset的HW和LEO概念.png" alt="offset的HW和LEO概念" /></p>
<p>如上图所示: 每个副本会同时维护 HW 与 LEO 值：</p>
<ul>
<li>
<p>Leader 保证只有 HW 及其之前的消息，才对消费者是可见的。</p>
</li>
<li>
<p>Follower 宕机后重启时会对其日志截断，只保留 HW 及其之前的日志消息（新版本有改动）</p>
</li>
<li>
<p>对于日志末端位移, 即 Log End Offset (LEO)。它表示副本写入下一条消息的位移值。注意: 数字 12 所在的方框是虚线，说明这个副本当前只有 12 条消息，位移值是从 0 到 11，下一条新消息的位移是 12。显然，介于高水位和 LEO 之间的消息就属于未提交消息。<strong>即同一个副本对象，其高水位值不会大于 LEO 值。</strong></p>
</li>
<li>
<p>高水位和 LEO 是副本对象的两个重要属性。Kafka 使用 Leader 副本的高水位来定义所在分区的高水位。即分区的高水位就是其 Leader 副本的高水位。</p>
</li>
</ul>
<h3 id="tradeoff"><a class="header" href="#tradeoff">TradeOff</a></h3>
<p>Keeping track of what has been consumed is, surprisingly, one of the key performance points of a messaging system.
Most messaging systems keep metadata about what messages have been consumed on the broker. That is, as a message is handed out to a consumer, the broker either records that fact locally immediately or it may wait for acknowledgement from the consumer. This is a fairly intuitive choice, and indeed for a single machine server it is not clear where else this state could go. Since the data structures used for storage in many messaging systems scale poorly, this is also a pragmatic choice--since the broker knows what is consumed it can immediately delete it, keeping the data size small.</p>
<p>What is perhaps not obvious is that getting the broker and consumer to come into agreement about what has been consumed is not a trivial problem. If the broker records a message as consumed immediately every time it is handed out over the network, then if the consumer fails to process the message (say because it crashes or the request times out or whatever) that message will be lost. To solve this problem, many messaging systems add an acknowledgement feature which means that messages are only marked as sent not consumed when they are sent; the broker waits for a specific acknowledgement from the consumer to record the message as consumed. This strategy fixes the problem of losing messages, but creates new problems. <strong>First of all, if the consumer processes the message but fails before it can send an acknowledgement then the message will be consumed twice. The second problem is around performance</strong>, now the broker must keep multiple states about every single message (first to lock it so it is not given out a second time, and then to mark it as permanently consumed so that it can be removed). Tricky problems must be dealt with, like what to do with messages that are sent but never acknowledged.</p>
<p>Kafka handles this differently. Our topic is divided into a set of totally ordered partitions, each of which is consumed by exactly one consumer within each subscribing consumer group at any given time. This means that the position of a consumer in each partition is just a single integer, the offset of the next message to consume. This makes the state about what has been consumed very small, just one number for each partition. This state can be periodically checkpointed. This makes the equivalent of message acknowledgements very cheap.</p>
<p>There is a side benefit of this decision. A consumer can deliberately rewind back to an old offset and re-consume data. This violates the common contract of a queue, but turns out to be an essential feature for many consumers. For example, if the consumer code has a bug and is discovered after some messages are consumed, the consumer can re-consume those messages once the bug is fixed.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../chapter_6/notes/Kafka_Day3.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../chapter_6/Book.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../chapter_6/notes/Kafka_Day3.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../chapter_6/Book.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../../mermaid.min.js"></script>
        <script type="text/javascript" src="../../mermaid-init.js"></script>
        <script type="text/javascript" src="../../smart-anchor.js"></script>
        <script src="https://utteranc.es/client.js"
        repo="RustMagazine/rust_magazine_2021"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async></script>

    </body>
</html>
